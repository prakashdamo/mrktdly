<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticker Analysis - Daily Market Summary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body class="bg-slate-900 text-white antialiased">
    <div class="container mx-auto px-6 py-8 max-w-7xl">
        <!-- Header -->
        <header class="mb-12">
            <a href="/" class="text-blue-400 hover:text-blue-300 mb-6 inline-flex items-center gap-2 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Back to Home
            </a>
            
            <!-- Hero Section -->
            <div class="bg-gradient-to-br from-slate-800/70 to-slate-800/40 backdrop-blur-sm rounded-2xl p-8 shadow-2xl border border-slate-700/40 mb-8">
                <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
                    <div class="flex-1">
                        <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mb-3" id="tickerTitle">
                            Loading...
                        </h1>
                        <div class="flex items-center gap-4 text-gray-400 mb-4" id="tickerStats"></div>
                        <div id="mlSignal" class="hidden"></div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-3">
                        <!-- Health Score Badge -->
                        <div id="healthScoreBadge" class="hidden px-6 py-3 bg-gradient-to-r from-slate-700 to-slate-600 rounded-xl border border-slate-500/50">
                            <div class="flex items-center gap-3">
                                <div class="text-center">
                                    <div class="text-xs text-gray-400 mb-1">Health Score</div>
                                    <div class="flex items-center gap-2">
                                        <span id="healthEmoji" class="text-2xl"></span>
                                        <span id="healthScore" class="text-2xl font-bold"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="showMLPrediction()" class="group relative px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-semibold flex items-center gap-2 transition-all duration-300 hover:scale-105 shadow-lg shadow-purple-500/30">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                            </svg>
                            ML Strategy
                        </button>
                        <button class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-medium transition-all duration-300 hover:scale-105">
                            Add to Watchlist
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Loading State -->
        <div id="loading" class="text-center py-20">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
            <p class="text-gray-400 mt-4">Analyzing ticker...</p>
        </div>

        <!-- Content -->
        <div id="content" class="hidden space-y-8">
            <!-- Technical Health Score Card -->
            <div id="healthScoreCard" class="bg-gradient-to-br from-slate-800/70 to-slate-800/40 backdrop-blur-sm rounded-2xl p-8 shadow-2xl border border-slate-700/40">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    <span class="text-3xl">üè•</span>
                    Technical Health Score
                </h2>
                <div id="healthScoreContent" class="text-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"></div>
                    <p class="text-gray-400 mt-3 text-sm">Calculating health score...</p>
                </div>
            </div>
            <!-- Price Range Visualization -->
            <section class="bg-gradient-to-br from-slate-800/70 to-slate-800/40 backdrop-blur-sm rounded-2xl p-8 shadow-xl border border-slate-700/30">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-8 bg-gradient-to-b from-cyan-400 to-blue-600 rounded-full"></div>
                    <h2 class="text-2xl font-bold">52-Week Price Range</h2>
                </div>
                
                <!-- 52-Week Gauge -->
                <div class="mb-8">
                    <div id="priceGauge" class="relative h-16 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 rounded-full overflow-hidden">
                        <div id="priceMarker" class="absolute top-0 bottom-0 w-1 bg-white shadow-lg" style="left: 50%">
                            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-white text-slate-900 px-3 py-1 rounded-lg font-bold text-sm whitespace-nowrap"></div>
                        </div>
                    </div>
                    <div class="flex justify-between mt-2 text-sm text-gray-400">
                        <span id="low52w">$0</span>
                        <span id="percentile" class="font-medium"></span>
                        <span id="high52w">$0</span>
                    </div>
                </div>
                
                <!-- Price Distribution Heatmap -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Price Distribution (Past Year)</h3>
                    <div id="priceHeatmap" style="height: 400px;"></div>
                </div>
            </section>
            
            <!-- Model Performance -->
            <section class="bg-gradient-to-br from-slate-800/70 to-slate-800/40 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-8 bg-gradient-to-b from-purple-400 to-pink-600 rounded-full"></div>
                    <h2 class="text-2xl font-bold">Model Track Record</h2>
                </div>
                <div id="modelPerformance">
                    <div class="text-center text-gray-400 py-4">Loading performance data...</div>
                </div>
            </section>

            <!-- Two Column Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Trend Analysis -->
                <section class="bg-gradient-to-br from-slate-800/60 to-slate-800/30 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-2 h-8 bg-gradient-to-b from-blue-400 to-cyan-600 rounded-full"></div>
                        <h2 class="text-2xl font-bold">Trend Analysis</h2>
                    </div>
                    <div id="trendAnalysis" class="grid grid-cols-2 gap-4"></div>
                </section>

                <!-- Fibonacci Levels -->
                <section class="bg-gradient-to-br from-slate-800/60 to-slate-800/30 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-2 h-8 bg-gradient-to-b from-green-400 to-emerald-600 rounded-full"></div>
                        <h2 class="text-2xl font-bold">Fibonacci Levels</h2>
                    </div>
                    <div class="text-sm text-gray-400 mb-4">Based on recent swing</div>
                    <div id="fibonacciLevels" class="space-y-2"></div>
                </section>
            </div>

            <!-- Price Action -->
            <section class="bg-gradient-to-br from-slate-800/60 to-slate-800/30 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-8 bg-gradient-to-b from-orange-400 to-red-600 rounded-full"></div>
                    <h2 class="text-2xl font-bold">Price Action Summary</h2>
                </div>
                <p class="text-gray-300 leading-relaxed" id="priceAction"></p>
            </section>

            <!-- Two Column Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Technical Analysis -->
                <section class="bg-gradient-to-br from-slate-800/60 to-slate-800/30 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-2 h-8 bg-gradient-to-b from-teal-400 to-cyan-600 rounded-full"></div>
                        <h2 class="text-2xl font-bold">Technical Analysis</h2>
                    </div>
                    <ul class="space-y-3 text-gray-300" id="technicalAnalysis"></ul>
                </section>

                <!-- Key Levels -->
                <section class="bg-gradient-to-br from-slate-800/60 to-slate-800/30 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-2 h-8 bg-gradient-to-b from-yellow-400 to-orange-600 rounded-full"></div>
                        <h2 class="text-2xl font-bold">Key Levels</h2>
                    </div>
                    <div class="space-y-3" id="keyLevels"></div>
                </section>
            </div>

            <!-- Two Column Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Trading Considerations -->
                <section class="bg-gradient-to-br from-slate-800/60 to-slate-800/30 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-2 h-8 bg-gradient-to-b from-indigo-400 to-purple-600 rounded-full"></div>
                        <h2 class="text-2xl font-bold">Trading Considerations</h2>
                    </div>
                    <ul class="space-y-3 text-gray-300" id="tradingConsiderations"></ul>
                </section>

                <!-- Risk Assessment -->
                <section class="bg-gradient-to-br from-slate-800/60 to-slate-800/30 backdrop-blur-sm rounded-2xl p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-700/30">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-2 h-8 bg-gradient-to-b from-red-400 to-rose-600 rounded-full"></div>
                        <h2 class="text-2xl font-bold">Risk Assessment</h2>
                    </div>
                    <ul class="space-y-3 text-gray-300" id="riskAssessment"></ul>
                </section>
            </div>

            <!-- Disclaimer -->
            <div class="bg-yellow-900/20 border border-yellow-700/50 rounded-lg p-6">
                <p class="text-sm text-yellow-200 text-center">
                    <strong>EDUCATIONAL CONTENT ONLY:</strong> This analysis is for educational purposes only and does not constitute 
                    financial advice, investment recommendations, or an offer to buy or sell securities. Always conduct your own 
                    research and consult with a licensed financial advisor before making investment decisions.
                </p>
            </div>
        </div>

        <!-- Error State -->
        <div id="error" class="hidden text-center py-20">
            <p class="text-red-400 text-xl">Unable to load analysis</p>
            <p class="text-gray-400 mt-2">Please try again</p>
            <a href="/" class="mt-4 inline-block text-blue-400 hover:text-blue-300">‚Üê Back to Home</a>
        </div>
    </div>

    <script>
        async function loadPerformanceStats(ticker) {
            try {
                const response = await fetch(`https://xfi2u4ajm9.execute-api.us-east-1.amazonaws.com/prod/signal-stats?ticker=${ticker}&days=30`);
                const stats = await response.json();
                
                const perfDiv = document.getElementById('modelPerformance');
                
                if (stats.total_signals === 0) {
                    perfDiv.innerHTML = '<div class="text-gray-400 text-center">No signals yet for this ticker</div>';
                    return;
                }
                
                perfDiv.innerHTML = `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-[#252a3a] rounded-lg p-4 text-center">
                            <div class="text-gray-400 text-xs mb-1">Win Rate</div>
                            <div class="text-2xl font-bold ${stats.win_rate >= 60 ? 'text-green-400' : 'text-yellow-400'}">${stats.win_rate}%</div>
                            <div class="text-xs text-gray-500">${stats.win_count}/${stats.closed_signals}</div>
                        </div>
                        <div class="bg-[#252a3a] rounded-lg p-4 text-center">
                            <div class="text-gray-400 text-xs mb-1">Expectancy</div>
                            <div class="text-2xl font-bold ${stats.expectancy > 0 ? 'text-green-400' : 'text-red-400'}">${stats.expectancy > 0 ? '+' : ''}${stats.expectancy}%</div>
                            <div class="text-xs text-gray-500">per trade</div>
                        </div>
                        <div class="bg-[#252a3a] rounded-lg p-4 text-center">
                            <div class="text-gray-400 text-xs mb-1">Avg Win/Loss</div>
                            <div class="text-lg font-bold text-white">+${stats.avg_win}% / ${stats.avg_loss}%</div>
                            <div class="text-xs text-gray-500">R:R ${stats.risk_reward}:1</div>
                        </div>
                        <div class="bg-[#252a3a] rounded-lg p-4 text-center">
                            <div class="text-gray-400 text-xs mb-1">High Conviction</div>
                            <div class="text-2xl font-bold text-purple-400">${stats.high_conviction_win_rate}%</div>
                            <div class="text-xs text-gray-500">>80% confidence</div>
                        </div>
                    </div>
                    
                    <div class="mb-2 text-sm font-semibold text-gray-300">Recent Signals (Last 10)</div>
                    <div class="space-y-2">
                        ${stats.recent_signals.map(s => `
                            <div class="bg-[#252a3a] rounded-lg p-3 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="text-xs font-mono text-gray-400">${s.date}</span>
                                    <span class="px-2 py-1 rounded text-xs font-bold ${s.action === 'BUY' ? 'bg-green-900/50 text-green-400' : 'bg-red-900/50 text-red-400'}">${s.action}</span>
                                    <span class="text-sm text-gray-300">$${s.entry} ‚Üí $${s.target}</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    ${s.status === 'OPEN' ? 
                                        '<span class="text-xs text-blue-400">‚è≥ Open</span>' :
                                        s.outcome === 'WIN' ?
                                        `<span class="text-sm font-bold text-green-400">‚úÖ +${s.return_pct}%</span>` :
                                        `<span class="text-sm font-bold text-red-400">‚ùå ${s.return_pct}%</span>`
                                    }
                                    ${s.days_held ? `<span class="text-xs text-gray-500">${s.days_held}d</span>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading performance:', error);
                document.getElementById('modelPerformance').innerHTML = 
                    '<div class="text-gray-400 text-center">Performance data unavailable</div>';
            }
        }

        function displayAnalysis() {
            const data = JSON.parse(sessionStorage.getItem('tickerAnalysis'));
            
            if (!data) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                return;
            }

            const { ticker, data: tickerData, analysis } = data;

            // Title and stats
            const changeColor = tickerData.change >= 0 ? 'text-green-400' : 'text-red-400';
            document.getElementById('tickerTitle').textContent = `${ticker} Analysis`;
            document.getElementById('tickerStats').innerHTML = `
                <span class="text-3xl font-bold">$${tickerData.price}</span>
                <span class="${changeColor} font-semibold">${tickerData.change >= 0 ? '+' : ''}${tickerData.change} (${tickerData.change_percent}%)</span>
                <span class="text-gray-500">|</span>
                <span>Vol: ${tickerData.volume.toLocaleString()}</span>
                <span class="text-gray-500">|</span>
                <span>52W: $${tickerData.low_52w} - $${tickerData.high_52w}</span>
            `;

            // Trend Analysis
            if (tickerData.trend) {
                const trendDiv = document.getElementById('trendAnalysis');
                const trendColor = tickerData.trend.direction.includes('Up') ? 'text-green-400' : 
                                   tickerData.trend.direction.includes('Down') ? 'text-red-400' : 'text-yellow-400';
                trendDiv.innerHTML = `
                    <div class="bg-[#252a3a] rounded-lg p-4 text-center">
                        <div class="text-gray-400 text-xs mb-1">Direction</div>
                        <div class="${trendColor} text-lg font-bold">${tickerData.trend.direction}</div>
                    </div>
                    <div class="bg-[#252a3a] rounded-lg p-4 text-center">
                        <div class="text-gray-400 text-xs mb-1">Strength</div>
                        <div class="text-white text-lg font-bold">${tickerData.trend.strength}</div>
                    </div>
                    <div class="bg-[#252a3a] rounded-lg p-4 text-center">
                        <div class="text-gray-400 text-xs mb-1">Momentum</div>
                        <div class="text-white text-lg font-bold">${tickerData.trend.momentum}</div>
                    </div>
                    <div class="bg-[#252a3a] rounded-lg p-4 col-span-2 md:col-span-1">
                        <div class="text-gray-400 text-xs mb-1">Analysis</div>
                        <div class="text-gray-300 text-sm">${tickerData.trend.description}</div>
                    </div>
                `;
            }

            // Price Range Visualization
            if (tickerData.price_distribution) {
                // 52-Week Gauge
                const percentile = ((tickerData.price - tickerData.low_52w) / (tickerData.high_52w - tickerData.low_52w)) * 100;
                document.getElementById('low52w').textContent = `$${tickerData.low_52w}`;
                document.getElementById('high52w').textContent = `$${tickerData.high_52w}`;
                document.getElementById('percentile').textContent = `${percentile.toFixed(0)}th percentile`;
                
                const marker = document.getElementById('priceMarker');
                marker.style.left = `${percentile}%`;
                marker.querySelector('div').textContent = `$${tickerData.price}`;
                
                // Price Distribution Heatmap
                const dist = tickerData.price_distribution;
                const trace = {
                    x: dist.levels.map(l => l.count),
                    y: dist.levels.map(l => l.price),
                    type: 'bar',
                    orientation: 'h',
                    marker: {
                        color: dist.levels.map(l => l.count),
                        colorscale: [[0, '#1e293b'], [0.5, '#3b82f6'], [1, '#22c55e']],
                        showscale: false
                    },
                    hovertemplate: '$%{y:.2f}<br>%{x} days<extra></extra>'
                };
                
                const layout = {
                    paper_bgcolor: 'transparent',
                    plot_bgcolor: 'transparent',
                    font: { color: '#e2e8f0' },
                    xaxis: { title: 'Days at Price Level', gridcolor: '#334155' },
                    yaxis: { title: 'Price', gridcolor: '#334155' },
                    margin: { l: 60, r: 20, t: 20, b: 60 },
                    height: 400,
                    shapes: [{
                        type: 'line',
                        y0: tickerData.price,
                        y1: tickerData.price,
                        x0: 0,
                        x1: 1,
                        xref: 'paper',
                        line: { color: '#fff', width: 2, dash: 'dash' }
                    }],
                    annotations: [{
                        y: tickerData.price,
                        x: 1,
                        xref: 'paper',
                        text: `Current: $${tickerData.price}`,
                        showarrow: false,
                        xanchor: 'left',
                        font: { color: '#fff', size: 12 }
                    }]
                };
                
                Plotly.newPlot('priceHeatmap', [trace], layout, {responsive: true});
            }

            // Fibonacci Levels
            if (tickerData.fibonacci) {
                const fibDiv = document.getElementById('fibonacciLevels');
                const fib = tickerData.fibonacci;
                const currentPrice = tickerData.price;
                
                const levels = [
                    { name: '0.0% (High)', value: fib.level_0, pct: '0.0%' },
                    { name: '23.6%', value: fib.level_236, pct: '23.6%' },
                    { name: '38.2%', value: fib.level_382, pct: '38.2%' },
                    { name: '50.0%', value: fib.level_500, pct: '50.0%' },
                    { name: '61.8%', value: fib.level_618, pct: '61.8%' },
                    { name: '78.6%', value: fib.level_786, pct: '78.6%' },
                    { name: '100% (Low)', value: fib.level_100, pct: '100%' }
                ];
                
                levels.forEach(level => {
                    const isNear = Math.abs(currentPrice - level.value) / currentPrice < 0.02; // Within 2%
                    const div = document.createElement('div');
                    div.className = `flex justify-between items-center p-3 rounded ${isNear ? 'bg-purple-900/30 border border-purple-500' : 'bg-[#252a3a]'}`;
                    div.innerHTML = `
                        <span class="text-gray-300">${level.name}</span>
                        <span class="font-mono font-bold ${isNear ? 'text-purple-400' : 'text-white'}">$${level.value}</span>
                        ${isNear ? '<span class="text-xs text-purple-400">‚Üê Current</span>' : ''}
                    `;
                    fibDiv.appendChild(div);
                });
            }

            // Price Action
            document.getElementById('priceAction').textContent = analysis.price_action;

            // Technical Analysis
            const techList = document.getElementById('technicalAnalysis');
            analysis.technical_analysis.forEach(item => {
                const li = document.createElement('li');
                li.className = 'flex items-start';
                li.innerHTML = `<span class="text-purple-400 mr-2">‚Ä¢</span><span>${item}</span>`;
                techList.appendChild(li);
            });

            // Key Levels
            const levelsDiv = document.getElementById('keyLevels');
            analysis.key_levels.forEach(level => {
                const div = document.createElement('div');
                div.className = 'bg-[#252a3a] rounded-lg p-4';
                div.innerHTML = `
                    <div class="font-semibold text-purple-400 text-lg mb-2">$${level.level}</div>
                    <div class="text-gray-300 text-sm">${level.note}</div>
                `;
                levelsDiv.appendChild(div);
            });

            // Trading Considerations
            const tradingList = document.getElementById('tradingConsiderations');
            analysis.trading_considerations.forEach(item => {
                const li = document.createElement('li');
                li.className = 'flex items-start';
                li.innerHTML = `<span class="text-blue-400 mr-2">‚Ä¢</span><span>${item}</span>`;
                tradingList.appendChild(li);
            });

            // Risk Assessment
            const riskList = document.getElementById('riskAssessment');
            analysis.risk_assessment.forEach(item => {
                const li = document.createElement('li');
                li.className = 'flex items-start';
                li.innerHTML = `<span class="text-yellow-400 mr-2">‚ö†</span><span>${item}</span>`;
                riskList.appendChild(li);
            });

            // Show content
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            
            // Load performance stats and health score
            loadPerformanceStats(ticker);
            loadHealthScore(ticker);
        }

        // Load Technical Health Score
        async function loadHealthScore(ticker) {
            try {
                const response = await fetch(`https://xfi2u4ajm9.execute-api.us-east-1.amazonaws.com/prod/health-score?ticker=${ticker}`);
                const data = await response.json();
                
                // Update badge in header
                document.getElementById('healthEmoji').textContent = data.emoji;
                document.getElementById('healthScore').textContent = `${data.score}/100`;
                document.getElementById('healthScoreBadge').classList.remove('hidden');
                
                // Update detailed card
                const scoreColor = data.score >= 80 ? 'text-green-400' : 
                                  data.score >= 60 ? 'text-yellow-400' : 
                                  data.score >= 40 ? 'text-orange-400' : 'text-red-400';
                
                const ratingBg = data.score >= 80 ? 'from-green-900/30 to-green-800/20' : 
                                data.score >= 60 ? 'from-yellow-900/30 to-yellow-800/20' : 
                                data.score >= 40 ? 'from-orange-900/30 to-orange-800/20' : 'from-red-900/30 to-red-800/20';
                
                document.getElementById('healthScoreContent').innerHTML = `
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Score Display -->
                        <div class="text-center">
                            <div class="inline-block bg-gradient-to-br ${ratingBg} rounded-2xl p-8 mb-4">
                                <div class="text-6xl mb-2">${data.emoji}</div>
                                <div class="${scoreColor} text-5xl font-bold mb-2">${data.score}/100</div>
                                <div class="text-xl text-gray-300">${data.rating}</div>
                            </div>
                            
                            <!-- Components Breakdown -->
                            <div class="mt-6 space-y-2 text-left">
                                <h3 class="text-sm font-semibold text-gray-400 mb-3">Score Components:</h3>
                                ${Object.entries(data.components).map(([key, value]) => {
                                    const maxScore = key === 'moving_averages' ? 30 : 
                                                   key === 'momentum' ? 25 : 
                                                   key === 'rsi' ? 20 : 
                                                   key === 'volume' ? 15 : 10;
                                    const percentage = (value / maxScore) * 100;
                                    return `
                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span class="text-gray-400 capitalize">${key.replace('_', ' ')}</span>
                                                <span class="font-semibold">${value}/${maxScore}</span>
                                            </div>
                                            <div class="w-full bg-slate-700 rounded-full h-2">
                                                <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- Signals & Technicals -->
                        <div class="text-left space-y-6">
                            <!-- Key Signals -->
                            <div>
                                <h3 class="text-lg font-semibold mb-3 text-gray-300">üìä Key Signals</h3>
                                <div class="space-y-2">
                                    ${data.signals.map(signal => `
                                        <div class="flex items-start gap-2 text-sm">
                                            <span class="text-blue-400 mt-0.5">‚Ä¢</span>
                                            <span class="text-gray-300">${signal}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Technical Details -->
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <h3 class="text-sm font-semibold mb-3 text-gray-400">Technical Details</h3>
                                <div class="grid grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <div class="text-gray-500">Price</div>
                                        <div class="font-semibold">$${data.technicals.price.toFixed(2)}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-500">RSI</div>
                                        <div class="font-semibold">${data.technicals.rsi.toFixed(1)}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-500">20 MA</div>
                                        <div class="font-semibold">$${data.technicals.sma20.toFixed(2)}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-500">50 MA</div>
                                        <div class="font-semibold">$${data.technicals.sma50.toFixed(2)}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-500">1M Momentum</div>
                                        <div class="font-semibold ${data.technicals.momentum_1m >= 0 ? 'text-green-400' : 'text-red-400'}">
                                            ${data.technicals.momentum_1m > 0 ? '+' : ''}${data.technicals.momentum_1m.toFixed(2)}%
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-gray-500">3M Momentum</div>
                                        <div class="font-semibold ${data.technicals.momentum_3m >= 0 ? 'text-green-400' : 'text-red-400'}">
                                            ${data.technicals.momentum_3m > 0 ? '+' : ''}${data.technicals.momentum_3m.toFixed(2)}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-xs text-gray-500 text-center pt-4">
                                Updated: ${new Date(data.timestamp).toLocaleString()}
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading health score:', error);
                document.getElementById('healthScoreContent').innerHTML = `
                    <div class="text-center text-gray-400">
                        <p class="mb-2">Unable to load health score</p>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;
            }
        }

        // Load on page load
        displayAnalysis();

        // ML Prediction Modal
        async function showMLPrediction() {
            const ticker = new URLSearchParams(window.location.search).get('ticker');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gradient-to-br from-slate-900 to-slate-800 border border-purple-500/50 rounded-xl p-8 max-w-lg w-full mx-4">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold">ü§ñ ML Strategy Prediction</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    <div id="mlContent" class="text-center py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto"></div>
                        <p class="text-gray-400 mt-4">Loading ML predictions...</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            try {
                const response = await fetch(`https://xfi2u4ajm9.execute-api.us-east-1.amazonaws.com/prod/ml-strategy?ticker=${ticker}`);
                const data = await response.json();
                
                document.getElementById('mlContent').innerHTML = `
                    <div class="text-left space-y-6">
                        <div class="bg-purple-900/30 rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-3 text-purple-300">Optimal Strategy</h3>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="text-gray-400 text-sm">Target</div>
                                    <div class="text-2xl font-bold text-green-400">+${data.strategy.target}%</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-gray-400 text-sm">Stop Loss</div>
                                    <div class="text-2xl font-bold text-red-400">-${data.strategy.stop}%</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-gray-400 text-sm">Hold</div>
                                    <div class="text-2xl font-bold text-blue-400">${data.strategy.hold_days}d</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-slate-800/50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-3 text-gray-300">Current Conditions</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">RSI:</span>
                                    <span class="font-semibold">${data.conditions.rsi}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Volatility:</span>
                                    <span class="font-semibold">${data.conditions.volatility}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">20d Return:</span>
                                    <span class="font-semibold ${data.conditions.return_20d >= 0 ? 'text-green-400' : 'text-red-400'}">${data.conditions.return_20d > 0 ? '+' : ''}${data.conditions.return_20d}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Above MA20:</span>
                                    <span class="font-semibold">${data.conditions.above_ma20 ? '‚úÖ Yes' : '‚ùå No'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Above MA50:</span>
                                    <span class="font-semibold">${data.conditions.above_ma50 ? '‚úÖ Yes' : '‚ùå No'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-xs text-gray-500 text-center">
                            Predictions based on ML model trained on 5,546 historical setups
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('mlContent').innerHTML = `
                    <div class="text-red-400">
                        <p class="font-semibold mb-2">Error loading predictions</p>
                        <p class="text-sm text-gray-400">${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
