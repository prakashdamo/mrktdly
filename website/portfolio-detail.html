<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Details - MarketDly</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/auth-helper.js?v=20251203-3"></script>
    <script src="/js/nav.js?v=20251203-3"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
    </style>
</head>
<body class="bg-slate-900 text-white antialiased">
    <div id="appNav" data-active="portfolio"></div>

    <div class="container mx-auto px-6 py-8 max-w-6xl">
        <div id="loading" class="text-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p class="text-gray-400">Loading portfolio...</p>
        </div>

        <div id="portfolioContent" class="hidden">
            <!-- Header -->
            <div class="mb-8">
                <h1 id="portfolioName" class="text-4xl font-bold mb-2"></h1>
                <p id="portfolioMeta" class="text-gray-400"></p>
            </div>

            <!-- Performance Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-slate-800/50 border border-slate-700/50 rounded-xl p-6">
                    <div class="text-sm text-gray-400 mb-1">Total Return</div>
                    <div id="totalReturn" class="text-3xl font-bold"></div>
                </div>
                <div class="bg-slate-800/50 border border-slate-700/50 rounded-xl p-6">
                    <div class="text-sm text-gray-400 mb-1">Current Value</div>
                    <div id="currentValue" class="text-3xl font-bold"></div>
                </div>
                <div class="bg-slate-800/50 border border-slate-700/50 rounded-xl p-6">
                    <div class="text-sm text-gray-400 mb-1">Starting Value</div>
                    <div id="startingValue" class="text-3xl font-bold">$10,000</div>
                </div>
            </div>

            <!-- Option B: Inline Metrics -->
            <div id="inlineMetrics" class="bg-slate-800/30 border border-slate-700/50 rounded-lg p-4 mb-8 text-sm">
                <div class="flex flex-wrap items-center gap-4 text-gray-300">
                    <span id="scoreInline" class="font-medium"></span>
                    <span class="text-gray-600">|</span>
                    <span id="benchmarkInline"></span>
                    <span class="text-gray-600">|</span>
                    <span id="volatilityInline"></span>
                    <span class="text-gray-600">|</span>
                    <span id="diversificationInline"></span>
                </div>
            </div>

            <!-- Option A: Dashboard Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-700/50 rounded-xl p-4">
                    <div class="text-xs text-blue-300 mb-1">Portfolio Score</div>
                    <div id="portfolioScore" class="text-2xl font-bold text-blue-400"></div>
                    <div id="scoreGrade" class="text-xs text-gray-400 mt-1"></div>
                </div>
                <div class="bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-700/50 rounded-xl p-4">
                    <div class="text-xs text-green-300 mb-1">vs S&P 500</div>
                    <div id="benchmarkDiff" class="text-2xl font-bold text-green-400"></div>
                    <div id="benchmarkStatus" class="text-xs text-gray-400 mt-1"></div>
                </div>
                <div class="bg-gradient-to-br from-yellow-900/30 to-yellow-800/20 border border-yellow-700/50 rounded-xl p-4">
                    <div class="text-xs text-yellow-300 mb-1">Volatility</div>
                    <div id="volatilityLevel" class="text-2xl font-bold text-yellow-400"></div>
                    <div id="volatilityDesc" class="text-xs text-gray-400 mt-1"></div>
                </div>
                <div class="bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-700/50 rounded-xl p-4">
                    <div class="text-xs text-purple-300 mb-1">Diversification</div>
                    <div id="diversificationScore" class="text-2xl font-bold text-purple-400"></div>
                    <div id="diversificationDesc" class="text-xs text-gray-400 mt-1"></div>
                </div>
            </div>

            <!-- Holdings -->
            <div class="bg-slate-800/50 border border-slate-700/50 rounded-xl p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">Holdings</h2>
                    <div class="flex gap-2">
                        <button onclick="runAIAnalysis()" id="aiAnalysisBtn" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-lg font-medium transition">
                            ü§ñ AI Analysis
                        </button>
                        <button onclick="runBacktest()" id="backtestBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium transition">
                            üîÆ Backtest (1, 3, 5 years)
                        </button>
                    </div>
                </div>
                <div id="holdingsTable" class="overflow-x-auto"></div>
            </div>

            <!-- AI Analysis Results -->
            <div id="aiAnalysisResults" class="hidden bg-gradient-to-br from-purple-900/20 to-pink-900/20 border border-purple-500/50 rounded-xl p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4">ü§ñ AI Portfolio Analysis</h2>
                <div id="aiAnalysisContent" class="prose prose-invert max-w-none"></div>
            </div>

            <!-- Backtest Results -->
            <div id="backtestResults" class="hidden bg-gradient-to-br from-purple-900/20 to-blue-900/20 border border-purple-500/50 rounded-xl p-6">
                <h2 class="text-2xl font-bold mb-4">üîÆ Backtest Results</h2>
                <p class="text-gray-400 mb-6">How would this portfolio have performed if started earlier?</p>
                
                <div id="backtestContent" class="space-y-6"></div>
            </div>
        </div>

        <div id="error" class="hidden text-center py-12">
            <div class="text-6xl mb-4">‚ùå</div>
            <h2 class="text-2xl font-bold mb-2">Portfolio Not Found</h2>
            <p class="text-gray-400 mb-6">This portfolio may have been deleted or doesn't exist.</p>
            <a href="/portfolio.html" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition inline-block">
                Back to Portfolios
            </a>
        </div>
    </div>

    <script>
        const API_URL = 'https://xfi2u4ajm9.execute-api.us-east-1.amazonaws.com/prod';
        const urlParams = new URLSearchParams(window.location.search);
        const portfolioId = urlParams.get('id');

        if (!portfolioId) {
            showError();
        } else {
            loadPortfolio();
        }

        async function loadPortfolio() {
            try {
                const response = await fetch(`${API_URL}/portfolio?portfolio_id=${portfolioId}`);
                
                if (!response.ok) {
                    showError();
                    return;
                }

                const portfolio = await response.json();

                document.getElementById('portfolioName').textContent = portfolio.portfolio_name;
                document.getElementById('portfolioMeta').textContent = `Created ${new Date(portfolio.created_at).toLocaleDateString()} ‚Ä¢ ${portfolio.is_public ? 'Public' : 'Private'}`;

                const returnPct = portfolio.total_return_pct;
                document.getElementById('totalReturn').textContent = `${returnPct >= 0 ? '+' : ''}${returnPct.toFixed(2)}%`;
                document.getElementById('totalReturn').className = `text-3xl font-bold ${returnPct >= 0 ? 'text-green-400' : 'text-red-400'}`;

                document.getElementById('currentValue').textContent = `$${portfolio.current_value.toLocaleString()}`;

                const table = `
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="text-left py-3 px-4">Ticker</th>
                                <th class="text-right py-3 px-4">Allocation</th>
                                <th class="text-right py-3 px-4">Entry Price</th>
                                <th class="text-right py-3 px-4">Current Price</th>
                                <th class="text-right py-3 px-4">Entry Value</th>
                                <th class="text-right py-3 px-4">Current Value</th>
                                <th class="text-right py-3 px-4">Return</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${portfolio.holdings.map(h => `
                                <tr class="border-b border-slate-700/50 hover:bg-slate-700/30">
                                    <td class="py-3 px-4 font-bold">${h.ticker}</td>
                                    <td class="text-right py-3 px-4">${h.allocation_pct.toFixed(1)}%</td>
                                    <td class="text-right py-3 px-4">$${h.entry_price.toFixed(2)}</td>
                                    <td class="text-right py-3 px-4">$${h.current_price.toFixed(2)}</td>
                                    <td class="text-right py-3 px-4">$${h.entry_value.toLocaleString()}</td>
                                    <td class="text-right py-3 px-4">$${h.current_value.toLocaleString()}</td>
                                    <td class="text-right py-3 px-4 font-bold ${h.return_pct >= 0 ? 'text-green-400' : 'text-red-400'}">
                                        ${h.return_pct >= 0 ? '+' : ''}${h.return_pct.toFixed(2)}%
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                document.getElementById('holdingsTable').innerHTML = table;

                // Calculate and display metrics
                calculateMetrics(portfolio);

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('portfolioContent').classList.remove('hidden');
            } catch (error) {
                showError();
            }
        }

        function calculateMetrics(portfolio) {
            const returnPct = portfolio.total_return_pct;
            const holdings = portfolio.holdings;
            
            // Sector mapping (simplified)
            const sectorMap = {
                'AAPL': 'Tech', 'MSFT': 'Tech', 'GOOGL': 'Tech', 'META': 'Tech', 'NVDA': 'Tech', 'AMD': 'Tech', 'INTC': 'Tech', 'TSLA': 'Auto', 'NFLX': 'Tech',
                'AMZN': 'Consumer', 'WMT': 'Consumer', 'TGT': 'Consumer', 'COST': 'Consumer', 'HD': 'Consumer', 'NKE': 'Consumer',
                'JPM': 'Finance', 'BAC': 'Finance', 'GS': 'Finance', 'MS': 'Finance', 'V': 'Finance', 'MA': 'Finance',
                'JNJ': 'Healthcare', 'PFE': 'Healthcare', 'UNH': 'Healthcare', 'ABBV': 'Healthcare',
                'XOM': 'Energy', 'CVX': 'Energy', 'COP': 'Energy',
                'DIS': 'Media', 'CMCSA': 'Media',
                'BA': 'Industrial', 'CAT': 'Industrial', 'GE': 'Industrial'
            };
            
            // Calculate sector allocation
            const sectorAllocation = {};
            holdings.forEach(h => {
                const sector = sectorMap[h.ticker] || 'Other';
                sectorAllocation[sector] = (sectorAllocation[sector] || 0) + h.allocation_pct;
            });
            
            const sectors = Object.keys(sectorAllocation);
            const numSectors = sectors.length;
            const maxSectorAllocation = Math.max(...Object.values(sectorAllocation));
            
            // 1. Portfolio Score (0-100)
            let score = 0;
            
            // Performance component (0-35 points)
            if (returnPct >= 30) score += 35;
            else if (returnPct >= 20) score += 30;
            else if (returnPct >= 15) score += 25;
            else if (returnPct >= 10) score += 20;
            else if (returnPct >= 5) score += 15;
            else if (returnPct >= 0) score += 10;
            else if (returnPct >= -5) score += 5;
            
            // Sector diversification (0-25 points)
            if (numSectors >= 5 && maxSectorAllocation < 40) score += 25;
            else if (numSectors >= 4 && maxSectorAllocation < 50) score += 20;
            else if (numSectors >= 3 && maxSectorAllocation < 60) score += 15;
            else if (numSectors >= 2) score += 10;
            else score += 5;
            
            // Holdings count (0-15 points)
            const numHoldings = holdings.length;
            if (numHoldings >= 10) score += 15;
            else if (numHoldings >= 7) score += 12;
            else if (numHoldings >= 5) score += 10;
            else if (numHoldings >= 3) score += 7;
            
            // Balance/concentration (0-15 points)
            const maxAllocation = Math.max(...holdings.map(h => h.allocation_pct));
            if (maxAllocation < 20) score += 15;
            else if (maxAllocation < 30) score += 12;
            else if (maxAllocation < 40) score += 8;
            else if (maxAllocation < 50) score += 4;
            
            // Consistency (0-10 points) - all holdings positive
            const allPositive = holdings.every(h => h.return_pct >= 0);
            const mostPositive = holdings.filter(h => h.return_pct >= 0).length / holdings.length;
            if (allPositive) score += 10;
            else if (mostPositive >= 0.8) score += 7;
            else if (mostPositive >= 0.6) score += 5;
            else if (mostPositive >= 0.4) score += 3;
            
            score = Math.min(100, Math.max(0, Math.round(score)));
            
            // Grade
            let grade = 'F';
            if (score >= 90) grade = 'A+';
            else if (score >= 85) grade = 'A';
            else if (score >= 80) grade = 'A-';
            else if (score >= 75) grade = 'B+';
            else if (score >= 70) grade = 'B';
            else if (score >= 65) grade = 'B-';
            else if (score >= 60) grade = 'C+';
            else if (score >= 55) grade = 'C';
            else if (score >= 50) grade = 'C-';
            else if (score >= 40) grade = 'D';
            
            // 2. Benchmark comparison (S&P 500 YTD ~26% in 2024)
            const spReturn = 26.0;
            const diff = returnPct - spReturn;
            const beating = diff > 0;
            
            // 3. Volatility (based on individual stock return spread)
            const returns = holdings.map(h => h.return_pct);
            const maxReturn = Math.max(...returns);
            const minReturn = Math.min(...returns);
            const returnSpread = maxReturn - minReturn;
            
            let volLevel = 'Low';
            let volRisk = 2;
            if (returnSpread > 100) { volLevel = 'Very High'; volRisk = 9; }
            else if (returnSpread > 60) { volLevel = 'High'; volRisk = 7; }
            else if (returnSpread > 30) { volLevel = 'Medium'; volRisk = 5; }
            else if (returnSpread > 15) { volLevel = 'Low-Med'; volRisk = 3; }
            
            // 4. Diversification score (sector-based)
            let divScore = 0;
            
            // Sector count (0-5 points)
            if (numSectors >= 5) divScore += 5;
            else if (numSectors >= 4) divScore += 4;
            else if (numSectors >= 3) divScore += 3;
            else if (numSectors >= 2) divScore += 2;
            else divScore += 1;
            
            // Sector balance (0-5 points)
            if (maxSectorAllocation < 30) divScore += 5;
            else if (maxSectorAllocation < 40) divScore += 4;
            else if (maxSectorAllocation < 50) divScore += 3;
            else if (maxSectorAllocation < 60) divScore += 2;
            else divScore += 1;
            
            divScore = Math.min(10, divScore);
            
            let divLevel = 'Poor';
            if (divScore >= 9) divLevel = 'Excellent';
            else if (divScore >= 7) divLevel = 'Good';
            else if (divScore >= 5) divLevel = 'Fair';
            
            const sectorBreakdown = Object.entries(sectorAllocation)
                .map(([sector, pct]) => `${sector}: ${pct.toFixed(0)}%`)
                .join(', ');
            
            // Update Dashboard Cards (Option A)
            document.getElementById('portfolioScore').textContent = score;
            document.getElementById('scoreGrade').textContent = `Grade: ${grade}`;
            
            document.getElementById('benchmarkDiff').textContent = `${diff >= 0 ? '+' : ''}${diff.toFixed(1)}%`;
            document.getElementById('benchmarkStatus').textContent = beating ? '‚úì Beating market' : '‚úó Underperforming';
            
            document.getElementById('volatilityLevel').textContent = volLevel;
            document.getElementById('volatilityDesc').textContent = `Risk: ${volRisk}/10`;
            
            document.getElementById('diversificationScore').textContent = `${divScore}/10`;
            document.getElementById('diversificationDesc').textContent = `${numSectors} sectors`;
            
            // Update Inline Metrics (Option B)
            document.getElementById('scoreInline').innerHTML = `Score: <span class="text-blue-400 font-bold">${grade}</span> (${score}/100)`;
            document.getElementById('benchmarkInline').innerHTML = `vs S&P: <span class="${beating ? 'text-green-400' : 'text-red-400'} font-bold">${diff >= 0 ? '+' : ''}${diff.toFixed(1)}%</span> ${beating ? '‚úì' : '‚úó'}`;
            document.getElementById('volatilityInline').innerHTML = `Volatility: <span class="text-yellow-400 font-bold">${volLevel}</span>`;
            document.getElementById('diversificationInline').innerHTML = `Diversification: <span class="text-purple-400 font-bold">${divScore}/10</span> (${numSectors} sectors)`;
        }

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        async function runAIAnalysis() {
            const btn = document.getElementById('aiAnalysisBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Analyzing...';

            try {
                const response = await fetch(`${API_URL}/portfolio?portfolio_id=${portfolioId}`);
                const portfolio = await response.json();

                if (!response.ok) {
                    throw new Error(portfolio.error);
                }

                // Build the AI prompt
                const prompt = buildAIPrompt(portfolio);
                
                // Display the prompt for now (you'll integrate with Bedrock later)
                displayAIPrompt(prompt, portfolio);
                
                document.getElementById('aiAnalysisResults').classList.remove('hidden');
                btn.textContent = '‚úì Analysis Complete';
            } catch (error) {
                alert('Error running AI analysis: ' + error.message);
                btn.disabled = false;
                btn.textContent = 'ü§ñ AI Analysis';
            }
        }

        function buildAIPrompt(portfolio) {
            const holdings = portfolio.holdings.map(h => 
                `${h.ticker}: ${h.allocation_pct.toFixed(1)}% (${h.return_pct >= 0 ? '+' : ''}${h.return_pct.toFixed(1)}%)`
            ).join(', ');

            const prompt = `Portfolio: ${holdings}
Return: ${portfolio.total_return_pct >= 0 ? '+' : ''}${portfolio.total_return_pct.toFixed(2)}%

Give ULTRA-SHORT analysis. Maximum 10 bullets total. Each bullet = 5-8 words max.

Format:
**COMPOSITION**
‚Ä¢ [5 words]
‚Ä¢ [5 words]

**TOP PERFORMER**
‚Ä¢ [ticker + number]

**BIGGEST RISK**
‚Ä¢ [5 words]

**ACTION** (Educational only)
‚Ä¢ [5 words]
‚Ä¢ [5 words]

NO explanations. NO sentences. Just facts.
End with: "Educational only. Not financial advice."`;

            return prompt;
        }

        async function displayAIPrompt(prompt, portfolio) {
            const content = document.getElementById('aiAnalysisContent');
            
            // Show loading state
            content.innerHTML = `
                <div class="flex items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"></div>
                    <span class="ml-4 text-gray-400">Generating AI analysis...</span>
                </div>
            `;

            try {
                // Call Bedrock via Lambda
                const response = await fetch(`${API_URL}/ai-analysis`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({prompt: prompt, portfolio_id: portfolioId})
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to generate analysis');
                }

                // Display the AI analysis
                content.innerHTML = `
                    <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-6">
                        <p class="text-sm text-yellow-300">
                            ‚ö†Ô∏è <strong>Educational Purposes Only:</strong> This AI-generated analysis is for educational and informational purposes only. 
                            It does not constitute financial advice. Always consult with a licensed financial advisor before making investment decisions.
                        </p>
                    </div>
                    <div class="prose prose-invert max-w-none">
                        ${formatAnalysis(data.analysis)}
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `
                    <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-4">
                        <p class="text-sm text-red-300">
                            ‚ùå Error generating analysis: ${error.message}
                        </p>
                    </div>
                `;
            }
        }

        function formatAnalysis(text) {
            // Convert markdown-style formatting to HTML
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n- /g, '<br>‚Ä¢ ')
                .replace(/^/, '<p>')
                .replace(/$/, '</p>');
        }

        async function runBacktest() {
            const btn = document.getElementById('backtestBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Running backtest...';

            try {
                const response = await fetch(`${API_URL}/backtest?portfolio_id=${portfolioId}`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error);
                }

                displayBacktestResults(data);
                document.getElementById('backtestResults').classList.remove('hidden');
                btn.textContent = '‚úì Backtest Complete';
            } catch (error) {
                alert('Error running backtest: ' + error.message);
                btn.disabled = false;
                btn.textContent = 'üîÆ Backtest (1, 3, 5 years)';
            }
        }

        function displayBacktestResults(data) {
            const content = document.getElementById('backtestContent');
            
            const actualReturn = data.actual_return_pct;
            const actualDate = new Date(data.actual_created).toLocaleDateString();

            let html = `
                <div class="bg-slate-800/50 border border-slate-700/50 rounded-xl p-4 mb-4">
                    <div class="text-sm text-gray-400 mb-1">Your Actual Performance</div>
                    <div class="text-2xl font-bold ${actualReturn >= 0 ? 'text-green-400' : 'text-red-400'}">
                        ${actualReturn >= 0 ? '+' : ''}${actualReturn.toFixed(2)}%
                    </div>
                    <div class="text-sm text-gray-400">Started: ${actualDate}</div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            `;

            data.backtests.forEach(bt => {
                const diff = bt.total_return_pct - actualReturn;
                const diffColor = diff >= 0 ? 'text-green-400' : 'text-red-400';
                
                html += `
                    <div class="bg-slate-800/50 border border-slate-700/50 rounded-xl p-4">
                        <div class="text-sm text-gray-400 mb-2">${bt.years} Year${bt.years > 1 ? 's' : ''} Ago</div>
                        <div class="text-2xl font-bold ${bt.total_return_pct >= 0 ? 'text-green-400' : 'text-red-400'} mb-2">
                            ${bt.total_return_pct >= 0 ? '+' : ''}${bt.total_return_pct.toFixed(2)}%
                        </div>
                        <div class="text-xs text-gray-500 mb-3">${bt.backtest_date}</div>
                        <div class="text-sm ${diffColor}">
                            ${diff >= 0 ? 'üìà' : 'üìâ'} ${diff >= 0 ? '+' : ''}${diff.toFixed(2)}% vs actual
                        </div>
                        <div class="mt-3 pt-3 border-t border-slate-700">
                            <details class="text-sm">
                                <summary class="cursor-pointer text-gray-400 hover:text-white">Holdings breakdown</summary>
                                <div class="mt-2 space-y-1">
                                    ${bt.holdings.map(h => `
                                        <div class="flex justify-between text-xs">
                                            <span>${h.ticker}</span>
                                            <span class="${h.return_pct >= 0 ? 'text-green-400' : 'text-red-400'}">
                                                ${h.return_pct >= 0 ? '+' : ''}${h.return_pct.toFixed(1)}%
                                            </span>
                                        </div>
                                    `).join('')}
                                </div>
                            </details>
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            // Find best backtest
            const best = data.backtests.reduce((max, bt) => bt.total_return_pct > max.total_return_pct ? bt : max);
            
            html += `
                <div class="mt-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                    <div class="text-sm font-medium text-blue-400 mb-1">üí° Insight</div>
                    <div class="text-sm text-gray-300">
                        Best entry would have been <strong>${best.years} year${best.years > 1 ? 's' : ''} ago</strong> 
                        (${best.backtest_date}) with a return of <strong class="text-green-400">+${best.total_return_pct.toFixed(2)}%</strong>
                    </div>
                </div>
            `;

            content.innerHTML = html;
        }
    </script>
</body>
</html>
